---
// src/components/HomePageHero.astro
import GlobalHeader from './GlobalHeader.astro';
---

<section id="hero" class="relative isolate min-h-screen bg-white dark:bg-gray-900">
  <!-- Overlay header so it doesn't consume layout height -->
  <div class="absolute inset-x-0 top-0 z-20">
    <GlobalHeader />
  </div>

  <!-- Background video stays behind -->
  <div class="absolute inset-0 -z-10 pointer-events-none">
    <video
      id="hero-video"
      class="w-full h-full object-cover"
      autoplay
      muted
      loop
      playsinline
      preload="auto"
      poster="/images/beach-image.png"
      aria-hidden="true"
    >
      <source src="/videos/beach.mp4" type="video/mp4" />
      <!-- Img inside <video> is ignored by most browsers; keep external fallback below -->
    </video>

    <!-- Video tint -->
    <div class="absolute inset-0 bg-gradient-to-b from-navy-dark/70 via-navy-dark/70 to-navy-dark/70"></div>

    <!-- Animated gradient fallback (hidden by default, shown via JS) -->
    <div id="gradient-fallback" class="hidden absolute inset-0"></div>
  </div>

  <!-- Decorative blobs (even further back) -->
  <div aria-hidden="true" class="absolute inset-x-0 -top-40 -z-20 transform-gpu overflow-hidden blur-3xl sm:-top-80">
    <div
      class="relative left-[calc(50%-11rem)] aspect-1155/678 w-144.5 -translate-x-1/2 rotate-30 bg-linear-to-tr from-[#ff80b5] to-[#9089fc] opacity-20 sm:left-[calc(50%-30rem)] sm:w-288.75">
    </div>
  </div>

  <!-- Hero content (above background) -->
  <div class="relative z-10 mx-auto max-w-7xl px-6 lg:px-8">
    <div class="mx-auto max-w-2xl py-28 sm:py-40 lg:py-48">
      <div class="hidden sm:mb-8 sm:flex sm:justify-center">
        <div class="relative rounded-full px-3 py-1 text-sm/6 text-gray-300 ring-1 ring-white/20 hover:ring-white/30 backdrop-blur-sm bg-white/10">
          Announcing our next round of funding.
          <a href="#" class="font-semibold text-indigo-300">
            <span aria-hidden="true" class="absolute inset-0"></span>Read more <span aria-hidden="true">&rarr;</span>
          </a>
        </div>
      </div>

  <!-- Hero content: fill height and center -->
  <div class="relative z-10 mx-auto max-w-7xl px-6 lg:px-8">
    <div class="flex min-h-screen items-center justify-center">
      <div class="max-w-2xl text-center">
        <h1 class="text-5xl sm:text-7xl font-semibold text-white">Data to enrich your online business</h1>
        <p class="mt-8 text-lg font-medium text-pretty text-gray-200 sm:text-xl/8">
          Anim aute id magna aliqua ad ad non deserunt sunt. Qui irure qui lorem cupidatat commodo.
        </p>
        <div class="mt-10 flex items-center justify-center gap-x-6">
          <a href="#" class="rounded-md bg-indigo-600 px-3.5 py-2.5 text-sm font-semibold text-white shadow-xs hover:bg-indigo-500 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">
            Get started
          </a>
          <a href="#" class="text-sm/6 font-semibold text-white">Learn more <span aria-hidden="true">‚Üí</span></a>
        </div>
      </div>
    </div>
  </div>

  <!-- Bottom decorative blob -->
  <div aria-hidden="true" class="absolute inset-x-0 top-[calc(100%-13rem)] -z-20 transform-gpu overflow-hidden blur-3xl sm:top-[calc(100%-30rem)]">
    <div
      class="relative left-[calc(50%+3rem)] aspect-1155/678 w-144.5 -translate-x-1/2 bg-linear-to-tr from-[#ff80b5] to-[#9089fc] opacity-20 sm:left-[calc(50%+36rem)] sm:w-288.75">
    </div>
  </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const video = document.getElementById('hero-video');
  const fallback = document.getElementById('gradient-fallback');

  console.log('üé¨ Video background initialization started');

  if (!video) {
    console.error('‚ùå Video element not found');
    showFallback();
    return;
  }

  const loadTimeout = setTimeout(() => {
    console.warn('‚è∞ Video loading timeout - showing fallback');
    showFallback();
  }, 3000);

  video.addEventListener('canplay', () => {
    console.log('‚úÖ Video can play');
    clearTimeout(loadTimeout);
  });

  video.addEventListener('loadeddata', () => {
    console.log('‚úÖ Video data loaded');
    clearTimeout(loadTimeout);
  });

  video.addEventListener('playing', () => {
    console.log('‚ñ∂Ô∏è Video is playing');
    hideFallback();
  });

  video.addEventListener('error', (e) => {
    console.error('‚ùå Video error:', e, video.error);
    clearTimeout(loadTimeout);
    showFallback();
  });

  video.play().then(() => {
    console.log('‚úÖ Video play() succeeded');
  }).catch(error => {
    console.error('‚ùå Video play() failed:', error);
    showFallback();
  });

  function showFallback() {
    if (fallback) fallback.classList.remove('hidden');
  }
  function hideFallback() {
    if (fallback) fallback.classList.add('hidden');
  }
});
</script>

<style>

#hero-video {
  width: 100%;
  height: 100%;
  object-fit: cover;
  min-height: 100vh; /* ensures full height */
}

/* Ensure the fallback animates and covers section */
@keyframes gradientShift {
  0% { background-position: 0% 50% }
  50% { background-position: 100% 50% }
  100% { background-position: 0% 50% }
}
#gradient-fallback {
  background: linear-gradient(-45deg, #667eea, #764ba2, #f093fb, #f5576c);
  background-size: 400% 400%;
  animation: gradientShift 15s ease infinite;
}
</style>
